/*
    dynamodb tables to host backend for titandb
        streams to lambda for 
            logging
            backup/versioning
*/
"edgestore":{
    "Type" : "AWS::DynamoDB::Table",
    "Properties" : {
        "TableName":{"Fn::Join":["_",[
            {"Ref":"AWS::StackName"}, 
            "edgestore"
        ]]},
        "ProvisionedThroughput":{
            "ReadCapacityUnits":"1",
            "WriteCapacityUnits":"1"
        },
        "AttributeDefinitions" : [ 
            {
                "AttributeName" : "hk",
                "AttributeType" : "S"
            },
            {
                "AttributeName" : "rk",
                "AttributeType" : "S"
            }
        ],
        "KeySchema" : [ 
            {
                "AttributeName" : "hk",
                "KeyType" : "HASH"
            },
            {
                "AttributeName" : "rk",
                "KeyType" : "RANGE"
            }
        ]
    }
},
"graphindex":{
    "Type" : "AWS::DynamoDB::Table",
    "Properties" : {
        "TableName":{"Fn::Join":["_",[
            {"Ref":"AWS::StackName"}, 
            "graphindex"
        ]]},
        "ProvisionedThroughput":{
            "ReadCapacityUnits":"1",
            "WriteCapacityUnits":"1"
        },
        "AttributeDefinitions" : [ 
            {
                "AttributeName" : "hk",
                "AttributeType" : "S"
            },
            {
                "AttributeName" : "rk",
                "AttributeType" : "S"
            }
        ],
        "KeySchema" : [ 
            {
                "AttributeName" : "hk",
                "KeyType" : "HASH"
            },
            {
                "AttributeName" : "rk",
                "KeyType" : "RANGE"
            }
        ]
    }
},
"systemProperties":{
    "Type" : "AWS::DynamoDB::Table",
    "Properties" : {
        "TableName":{"Fn::Join":["_",[
            {"Ref":"AWS::StackName"}, 
            "system_properties"
        ]]},
        "ProvisionedThroughput":{
            "ReadCapacityUnits":"1",
            "WriteCapacityUnits":"1"
        },
        "AttributeDefinitions" : [ 
            {
                "AttributeName" : "hk",
                "AttributeType" : "S"
            },
            {
                "AttributeName" : "rk",
                "AttributeType" : "S"
           }
        ],
        "KeySchema" : [ 
            {
                "AttributeName" : "hk",
                "KeyType" : "HASH"
            },
            {
                "AttributeName" : "rk",
                "KeyType" : "RANGE"
            }
        ]
    }
},
"systemlog":{
    "Type" : "AWS::DynamoDB::Table",
    "Properties" : {
        "TableName":{"Fn::Join":["_",[
            {"Ref":"AWS::StackName"}, 
            "systemlog"
        ]]},
        "ProvisionedThroughput":{
            "ReadCapacityUnits":"1",
            "WriteCapacityUnits":"1"
        },
        "AttributeDefinitions" : [ 
            {
                "AttributeName" : "hk",
                "AttributeType" : "S"
            },
            {
                "AttributeName" : "rk",
                "AttributeType" : "S"
            }
        ],
        "KeySchema" : [ 
            {
                "AttributeName" : "hk",
                "KeyType" : "HASH"
            },
            {
                "AttributeName" : "rk",
                "KeyType" : "RANGE"
            }
        ]
    }
},
"titanIds":{
    "Type" : "AWS::DynamoDB::Table",
    "Properties" : {
        "TableName":{"Fn::Join":["_",[
            {"Ref":"AWS::StackName"}, 
            "titan_ids"
        ]]},
        "ProvisionedThroughput":{
            "ReadCapacityUnits":"1",
            "WriteCapacityUnits":"1"
        },
        "AttributeDefinitions" : [ 
            {
                "AttributeName" : "hk",
                "AttributeType" : "S"
            },
            {
                "AttributeName" : "rk",
                "AttributeType" : "S"
            }
        ],
        "KeySchema" : [ 
            {
                "AttributeName" : "hk",
                "KeyType" : "HASH"
            },
            {
                "AttributeName" : "rk",
                "KeyType" : "RANGE"
            }
        ]
    }
},
"txlog":{
    "Type" : "AWS::DynamoDB::Table",
    "Properties" : {
        "TableName":{"Fn::Join":["_",[
            {"Ref":"AWS::StackName"}, 
            "txlog"
        ]]},
        "ProvisionedThroughput":{
            "ReadCapacityUnits":"1",
            "WriteCapacityUnits":"1"
        },
        "AttributeDefinitions" : [ 
            {
                "AttributeName" : "hk",
                "AttributeType" : "S"
            },
            {
                "AttributeName" : "rk",
                "AttributeType" : "S"
            }
        ],
        "KeySchema" : [ 
            {
                "AttributeName" : "hk",
                "KeyType" : "HASH"
            },
            {
                "AttributeName" : "rk",
                "KeyType" : "RANGE"
            }
        ]
    }
},
"ElasticSearch":{
    "Type" : "AWS::Elasticsearch::Domain",
    "Properties" : {
        "ElasticsearchClusterConfig" : {
            "DedicatedMasterEnabled" : false,
            "InstanceCount" : 1,
            "InstanceType" : "t2.micro.elasticsearch"
        },
        "EBSOptions":{
            "EBSEnabled" : true,
            "VolumeSize" : 10,
            "VolumeType" : "gp2"
        },
        "DomainName":{"Fn::Join":["-",[
            {"Ref":"AWS::StackName"},
            "elasticsearch"
        ]]},
        "AccessPolicies":{
            "Version": "2012-10-17",
            "Statement": [{
                "Effect": "Allow",
                "Principal": {
                    "AWS": {"Fn::GetAtt":["GremlinServerRole","Arn"]}
                },
                "Action": "es:*",
                "Resource": "arn:aws:*"
            }]
        }
    }
}

