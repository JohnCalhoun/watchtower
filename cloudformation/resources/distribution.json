/*
    cloudfront distirbution for website
    needs ssl termination 
    needs certificate
*/
"distribution":{
    "Type" : "AWS::CloudFront::Distribution",
    "Condition" : "CreateProdResources",
    "Properties" : {
        "DistributionConfig" :{
            "Aliases" : [
                {"Fn::Join":["",[ 
                    {"Ref":"AWS::StackName"},
                    ".",
                    {"Ref":"DNSName"}
                ]]},
                {"Ref":"DNSName"}
            ],
            "CacheBehaviors":[
                {
                    "Compress" : true,
                    "ForwardedValues" : {
                        "QueryString" : false
                    },
                    "DefaultTTL":"0",
                    "PathPattern":"/api",
                    "TargetOriginId" : "api",
                    "ViewerProtocolPolicy" : "redirect-to-https"
                }
            ],
            "DefaultCacheBehavior" : {
                "Compress" : true,
                "ForwardedValues" : {
                    "QueryString" : false
                },
                "TargetOriginId" : "bucket",
                "ViewerProtocolPolicy" : "redirect-to-https"
            } ,
            "DefaultRootObject" : "/index.html",
            "Enabled" : true,
            "Origins" : [ 
                {
                    "Id" : "bucket",
                    "DomainName" : {"Fn::GetAtt":["HostingBucket","DomainName"]},
                    "S3OriginConfig" : {
                        "OriginAccessIdentity" : ""
                    }
                },
                {
                    "Id" : "api",
                    "DomainName" : { "Fn::Join" : ["",[
                        "https://",
                        {"Ref":"Api"},
                        ".execute-api.",
                        {"Ref":"AWS::Region"},
                        ".amazonaws.com"
                    ]]},
                    "CustomOriginConfig":{
                        "HTTPSPort" : 443,
                        "OriginProtocolPolicy" : "https-only"
                    }
                } 
            ],
            "ViewerCertificate":{
                "AcmCertificateArn" :{"Ref":"Cert"} ,
                "SslSupportMethod":"sni-only"
            },
            "PriceClass" : "PriceClass_100"
        }
    }
}

