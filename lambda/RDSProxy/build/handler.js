function runscript(a,b){user=process.env.DBUSER,password=process.env.DBPASSWORD,endpoint=process.env.DBENDPOINT,database=process.env.DBNAME,script=fs.readFileSync(source_dir+"/scripts/"+a+".sql").toString(),schema=JSON.parse(fs.readFileSync(source_dir+"/scripts/"+a+".json"));var c=new Promise(function(a,c){console.log(val(b,schema));var d=mysql.createConnection({host:endpoint,user:user,password:password,database:database});d.connect(),d.config.queryFormat=function(a,b){return b?a.replace(/\:(\w+)/g,function(a,c){return b.hasOwnProperty(c)?this.escape(b[c]):a}.bind(this)):a},d.query(script,b,function(b,d){b&&c(b),a(d)}),d.end()});return c}var process=require("./process.js"),request=require("request"),fs=require("fs"),sql=require("mysql"),val=require("jsonschema").validate;exports.handler=function(a,b,c){console.log("Received event:",JSON.stringify(a,null,2)),body=JSON.parse(a.body),script=body.script,bindings=body.bindings,result=runscript(script,bindings),result.then(function(a){b.succed(a)},function(a){b.fail(data)})};